package kr.or.ddit.user.reference.service;

import java.sql.SQLException;
import java.util.List;
import java.util.Map;

import org.apache.commons.fileupload.FileItem;

import kr.or.ddit.user.reference.dao.IRefDao;
import kr.or.ddit.user.reference.dao.IRefDaoImpl;
import kr.or.ddit.user.refitem.dao.IRefItemDao;
import kr.or.ddit.user.refitem.dao.IRefItemDaoImpl;
import kr.or.ddit.utiles.RefAttachFileMapper;
import kr.or.ddit.vo.RefItemVO;
import kr.or.ddit.vo.RefVO;

public class IRefServiceImpl implements IRefService {

	private static IRefService service = new IRefServiceImpl();
	private IRefDao refDao;
	private IRefItemDao refitemDao;
	
	private IRefServiceImpl(){
		refDao = IRefDaoImpl.getInstance();
		refitemDao = IRefItemDaoImpl.getInstance();
	}
	
	public static IRefService getInstance(){
		return (service == null) ? service = new IRefServiceImpl() : service;
	}
	
	@Override
	public List<RefVO> refList(Map<String, String> params) {
		List<RefVO> refList = null;
		
		try {
			refList = refDao.refList(params);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return refList;
	}

	@Override
	public RefVO refInfo(Map<String, String> params) {
		RefVO refInfo = null;
		
		try {
			refInfo = refDao.refInfo(params);
		} catch (SQLException e) {
			e.printStackTrace();
		}
	return refInfo;
		
	}

	@Override
	public void insertRefInfo(RefVO refInfo, FileItem[] items) {

		try {
			String ref_no = refDao.insertRefInfo(refInfo);
			List<RefItemVO> refItemList = RefAttachFileMapper.mapping(items, ref_no);
			refitemDao.insertFile(refItemList);
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}

	@Override
	public void updateRefInfo(RefVO refInfo) {
		
		try {
			refDao.updateRefInfo(refInfo);
		} catch (SQLException e) {
			e.printStackTrace();
		}		
	}

	@Override
	public void deleteRefInfo(Map<String, String> params) {

		try {
			refDao.deleteRefInfo(params);
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}

	@Override
	public String totalCount(Map<String, String> params) {
		
		String totalCount = null;

		try {
			totalCount = refDao.totalCount(params);
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return totalCount;
	}

	@Override
	public void insertRefReplyInfo(RefVO refInfo) {
		
		try {
			refDao.insertRefReplyInfo(refInfo);
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
	
}
